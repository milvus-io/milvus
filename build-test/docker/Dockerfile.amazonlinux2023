# Amazon Linux 2023 Build Test
FROM amazonlinux:2023

# Install Go first (required by install_deps.sh)
RUN dnf install -y wget curl tar gzip && \
    wget -q https://go.dev/dl/go1.22.0.linux-amd64.tar.gz && \
    tar -C /usr/local -xzf go1.22.0.linux-amd64.tar.gz && \
    rm go1.22.0.linux-amd64.tar.gz

ENV PATH="/usr/local/go/bin:${PATH}"
ENV GOPATH="/root/go"
ENV GOBIN="/root/go/bin"

WORKDIR /milvus

# Copy source code
COPY . .

# Build script
CMD ["/bin/bash", "-c", "./scripts/install_deps.sh && make 2>&1 | tee /results/amazonlinux2023.log; echo $? > /results/amazonlinux2023.exit"]
