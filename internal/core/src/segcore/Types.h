// Licensed to the LF AI & Data foundation under one
// or more contributor license agreements. See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership. The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License. You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#pragma once

#include <iostream>
#include <map>
#include <string>
#include <vector>

#include "common/Types.h"
#include "common/type_c.h"
#include "index/Index.h"
#include "storage/Types.h"

namespace milvus::segcore {

// see also internal/querynode/load_index_info.go
struct LoadIndexInfo {
    int64_t collection_id;
    int64_t partition_id;
    int64_t segment_id;
    int64_t field_id;
    DataType field_type;
    // The element type of the field. It's not DataType::NONE if field_type is array/vector_array.
    DataType element_type;
    bool enable_mmap;
    std::string mmap_dir_path;
    int64_t index_id;
    int64_t index_build_id;
    int64_t index_version;
    std::map<std::string, std::string> index_params;
    std::vector<std::string> index_files;
    index::IndexBasePtr index;
    index::CacheIndexBasePtr cache_index;
    std::string uri;
    IndexVersion index_engine_version;
    proto::schema::FieldSchema schema;
    int64_t index_size;  // It's the size of index file before compressing
        // (aka. the filesize before loading operation at knowhere),
        // because the uncompressed-index-file-size may not be stored at previous milvus.
        // so the size may be not accurate (generated by the compressed-index-file-size multiplied with a compress-ratio)
    int64_t num_rows;
    int64_t dim;
    std::string
        warmup_policy;  // "disable" or "sync", empty means use global config

    // Default constructor
    LoadIndexInfo() = default;

    // Move constructor and assignment - use defaults
    LoadIndexInfo(LoadIndexInfo&&) = default;
    LoadIndexInfo&
    operator=(LoadIndexInfo&&) = default;

    // Copy constructor - copies metadata, leaves index pointers as nullptr
    // since they are populated later during actual index loading
    LoadIndexInfo(const LoadIndexInfo& other)
        : collection_id(other.collection_id),
          partition_id(other.partition_id),
          segment_id(other.segment_id),
          field_id(other.field_id),
          field_type(other.field_type),
          element_type(other.element_type),
          enable_mmap(other.enable_mmap),
          mmap_dir_path(other.mmap_dir_path),
          index_id(other.index_id),
          index_build_id(other.index_build_id),
          index_version(other.index_version),
          index_params(other.index_params),
          index_files(other.index_files),
          index(nullptr),
          cache_index(nullptr),
          uri(other.uri),
          index_engine_version(other.index_engine_version),
          schema(other.schema),
          index_size(other.index_size),
          num_rows(other.num_rows),
          dim(other.dim),
          warmup_policy(other.warmup_policy) {
    }

    // Copy assignment operator
    LoadIndexInfo&
    operator=(const LoadIndexInfo& other) {
        if (this != &other) {
            collection_id = other.collection_id;
            partition_id = other.partition_id;
            segment_id = other.segment_id;
            field_id = other.field_id;
            field_type = other.field_type;
            element_type = other.element_type;
            enable_mmap = other.enable_mmap;
            mmap_dir_path = other.mmap_dir_path;
            index_id = other.index_id;
            index_build_id = other.index_build_id;
            index_version = other.index_version;
            index_params = other.index_params;
            index_files = other.index_files;
            index = nullptr;
            cache_index = nullptr;
            uri = other.uri;
            index_engine_version = other.index_engine_version;
            schema = other.schema;
            index_size = other.index_size;
            num_rows = other.num_rows;
            dim = other.dim;
            warmup_policy = other.warmup_policy;
        }
        return *this;
    }
};

}  // namespace milvus::segcore
