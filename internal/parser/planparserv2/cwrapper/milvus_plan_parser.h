// Copyright (C) 2019-2025 Zilliz. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance
// with the License. You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software distributed under the License
// is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
// or implied. See the License for the specific language governing permissions and limitations under the License

#pragma once

#include <string>
#include <vector>

namespace milvus {
namespace planparserv2 {

// This wrapper is used to provide a C++ interface for the C interface generated by the Go build (cgo).
class PlanParser {
public:
    /**
     * @brief Register a schema to the plan parser. Currently all registered schemas must have unique names.
     * 
     * @param schema_proto The serialized CollectionSchema protobuf.
     * @return std::string The name of the registered schema.
     * @throws std::runtime_error if registration fails.
     */
    static std::string RegisterSchema(const std::vector<uint8_t>& schema_proto);

    /**
     * @brief Unregister a schema from the plan parser.
     * 
     * @param schema_name The name of the schema to unregister.
     */
    static void UnregisterSchema(const std::string& schema_name);

    /**
     * @brief Parse an expression string into a serialized PlanNode protobuf based on the registered schema.
     * 
     * @param schema_name The name of the schema associated with the expression.
     * @param expr The expression string to parse.
     * @return std::vector<uint8_t> The serialized PlanNode protobuf.
     * @throws std::runtime_error if parsing fails.
     */
    static std::vector<uint8_t> Parse(const std::string& schema_name, const std::string& expr);
};

} // namespace planparserv2
} // namespace milvus

